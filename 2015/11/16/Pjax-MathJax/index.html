<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Pjax与MathJax冲突的解决方案 | Nannan&#39;s Blog</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/component.css" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <meta name="generator" content="Nannan's Blog">
  <script src="http://static.duoshuo.com/embed.js"></script>
  
  
  

  
  
  <!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</head>
<body>
<div class="container">
    <div class="mp-pusher" id="mp-pusher">
        <i id="scroll-up" class="fa fa-angle-up"></i>
        <nav id="mp-menu" class="mp-menu">
            <div class="mp-level">
                <a data-pjax class="back-home" style="font-size: 20px" href="/"><h2 ><i class="fa fa-home"></i>
                        Home</h2></a>
                <ul class="first-level">
                    <li>
                        <a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Archive</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-archive"></i>
                                Archive</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-archive" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/11/16/Pjax-MathJax/">Pjax与MathJax冲突的解决方案</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2015/11/05/hello-world/">丑话说前</a>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Categories</a>

                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-copy"></i>
                                Categories</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-category" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-category-li mp-pjax">
                                    <a href="/categories/技术/">&nbsp;&nbsp;&nbsp;技术</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-category-li mp-pjax">
                                    <a href="/categories/随笔/">&nbsp;&nbsp;&nbsp;随笔</a>
                                    <small>1</small>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Tags</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-tags"></i>
                                Tags</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-tag" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/css/">&nbsp;&nbsp;&nbsp;css</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/javascript/">&nbsp;&nbsp;&nbsp;javascript</a>
                                    <small>1</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/随笔/">&nbsp;&nbsp;&nbsp;随笔</a>
                                    <small>1</small>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    
                    <li class="mp-pjax"><a class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a></li>
                    <li><a class="fa fa-github" href="#">&nbsp;&nbsp;&nbsp;Github</a></li>

                </ul>

            </div>
        </nav>
        <div id="pjax">
            <div class="pjax-hidden" style="display: none">
                
                    <a  data-pjax href="/2015/11/16/Pjax-MathJax/">Pjax与MathJax冲突的解决方案</a>
                
                    <a  data-pjax href="/2015/11/05/hello-world/">丑话说前</a>
                
                
                    <a data-pjax href="/categories/技术/">&nbsp;&nbsp;技术</a>
                
                    <a data-pjax href="/categories/随笔/">&nbsp;&nbsp;随笔</a>
                
                
                    <a data-pjax href="/tags/css/">&nbsp;&nbsp;css</a>
                
                    <a data-pjax href="/tags/javascript/">&nbsp;&nbsp;javascript</a>
                
                    <a data-pjax href="/tags/随笔/">&nbsp;&nbsp;随笔</a>
                
                <a data-pjax class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a>
            </div>
            <nav class="nexus">
                <li  style="border-left: 1px solid #c6d0da;">
                    <a id="trigger" href="#"><i class="fa fa-bars"></i></a>
                </li>
                <li ><a id="nexus-back" data-pjax href="/">Nannan&#39;s Blog</a></li>
                
                <div id="nav-container">
                    <div class="post-navbar" style="line-height: 63px;display:none">
                        <li id="navbar-title"><a href="#">Pjax与MathJax冲突的解决方案</a></li>
                        <li id="navbar-toc" style="border-left: none">
                            <a style="padding-right: 15px">
                                <span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
                            </a>
                            <div class="hidden-box">
                                <ul id="toc"></ul>
                            </div>
                        </li>
                    </div>
                </div>
                
            </nav>

            <div class="scroller">
            <div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->
  

<main class="content" role="main">
    <article class="post" >
    <span class="post-meta">
                  <div class="tag-tile">
                      
                      
                      <a data-pjax href='/tags/css/' style='color:#D5D5D5'>css</a>
                      
                      <a data-pjax href='/tags/javascript/' style='color:#D5D5D5'>javascript</a>
                      
                      
                  </div>
                <h1 class="post-title" style="margin: 14px 0;color:#50585D">Pjax与MathJax冲突的解决方案</h1>

                    <div class="post-meta">
                        Post on<span class="fa fa-clock-o"></span>
                        <time datetime="2015-11-16T01:08:37.000Z"
                              itemprop="datePublished">2015-11-16</time>
                    </div>
    </span>

        <section class="post-content">
            <p>首先，要感谢来自宝岛台湾的<em>tommy351</em>,这个博客正是基于他的杰作<a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>搭建而成的。同样也要感谢<em>yuche</em>设计的<a href="https://github.com/yuche/hexo-theme-kael" target="_blank" rel="external">kael</a>主题，他优秀的设计使得这个博客外观上显得并不寒碜。yuche在kael中加入了逐段评论功能，在我能找到的主题中，这或许是唯一去做如此“多余”的尝试的。但这附加上去的“多余”，使得它成为了我，只此一手的选择。再次感谢他们。</p>
<a id="more"></a>
<p>由于希望在这里写一些较“学术”的文章，我不得不在原有主题的基础上，加入MathJax支持，以期能在干净的页面上呈现数学公式。按照<a href="http://www.catxue.com/2015/03/20/MathJax/" target="_blank" rel="external">薛老板</a>及<a href="http://lukang.me/2014/mathjax-for-hexo.html" target="_blank" rel="external">Kang Lu</a>的解决方案，我没有成功的在kael中实现。经过一些测试后，发现Hexo在本地生成的一些不完整的页面是可以正常显示公式的，一旦将它们组合在一起作为blog运行时，数学公式就消失了。这使得我把焦点从Hexo转移到了kael上。事实证明，这是正确的。</p>
<h1 id="一、MathJax与Pjax">一、MathJax与Pjax</h1><p>阅读了yuche关于kael主题的<a href="http://yuche.me/introducing-kael-customization/" target="_blank" rel="external">说明</a>后，我发现作者使用了Pjax技术。Pjax的作用是通过减少HTTP的请求次数，加速页面载入的速度。Pjax的核心是Ajax，Ajax简单来讲就是避免浏览器重复解析网页的<strong>head</strong>部分，从而达到载入页面提速的目的。但页面中需要用到的js插件的声明，通常都是写在<strong>head</strong>中的。这就导致了Ajax与众多js插件冲突的问题。</p>
<p>虽然网上也有一些Ajax与MathJax冲突的解决方案，可是我并没有在Pjax中找到明确的Ajax部分。无奈之下，竟然查到了github上Pjax的<a href="https://github.com/defunkt/jquery-pjax" target="_blank" rel="external">开源项目</a>，在项目里第560条<a href="https://github.com/defunkt/jquery-pjax/issues/560" target="_blank" rel="external">issue</a>中，作者明确了给出了Pjax与其他Js冲突时，统一的解决方案：</p>
<blockquote>
<p>Plugins that are designed to only initialize things once on DOM load will not work well with pjax. You need plugins that use event delegation to handle all elements, even those that are dynamically added to the page using ajax (including pjax). One workaround you might try is to re-initialize plugins on every DOM load and pjax:end event:</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).on(<span class="string">"ready pjax:end"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// initialize plugins</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>注意到，这实质上提示了我将Ajax与MathJax冲突的解决方案移植到Pjax的具体位置。在kael主题中找到main.js，找到’pjax:end’部分，作如下修改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'pjax:end'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    NProgress.done();</span><br><span class="line">    $(<span class="string">'.scroller'</span>).css(<span class="string">'opacity'</span>,<span class="string">'1'</span>).removeClass(<span class="string">'fadeOut'</span>).addClass(<span class="string">'fadeIn'</span>);</span><br><span class="line">    afterPjax();</span><br><span class="line">    $(<span class="string">'#navbar-toc'</span>).hide();</span><br><span class="line">    $(<span class="string">'.nexus'</span>).css(<span class="string">'width'</span>, <span class="string">'auto'</span>);</span><br><span class="line">    $(<span class="string">'#navbar-title a'</span>).hide();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> MathJax !== <span class="string">'undefined'</span>) <span class="comment">// support MathJax</span></span><br><span class="line">        MathJax.Hub.Queue([<span class="string">"Typeset"</span>,MathJax.Hub]);</span><br></pre></td></tr></table></figure>
<p>当然，还需要在主题的layout文件夹中，找到head.ejs文件，按照<a href="http://lukang.me/2014/mathjax-for-hexo.html" target="_blank" rel="external">Kang Lu</a>的方法插入MathJax脚本。</p>
<p>一切就绪后，我在markdown中，尝试用Latex书写公式，用hexo提交到github后，应该能看到：</p>
<p>Fermi-Dirac function:<br>$$f_v(z<em>0)=\frac{1}{\Gamma(v)}\int</em>{0}^{\infty}\frac{x^{v-1}dx}{z<em>{0}^{-1} e^x+1}=\sum</em>{l=1}^\infty (-1)^{l-1}\frac{z_0^l}{l^v}$$</p>
<p>我已经在github上将修改push给了yuche，考虑到MathJax支持并不是广泛的需求，yuche未必会merge。如果有人喜欢这个主题并且跟我一样需要MathJax，却又不想太麻烦，可以直接从我的<a href="https://github.com/PokerN/hexo-theme-kael" target="_blank" rel="external">github</a>上将修改后的项目clone下来。</p>
<p>（enjoy~）</p>
<hr>
<p>上大力学所</p>

        </section>
        <hr/>
        <nav class="pagination" style="width:auto" role="pagination">
            
            <a style="cursor:default" class="newer-posts" href="#">This is the First Post</a>
            
            <a class="share-button" data-original-title title>Share this Post</a>
            
            <a data-pjax class="older-posts" href="/2015/11/05/hello-world/">Next Post →</a>
            
        </nav>
        <br/>
        <br/>
        <section id="comment">
            <div id="comment-box"></div>
        </section>


    </article>
</main>


  
<footer class="site-footer">
    
    <div class="inner">
        <section class="copyright"><a href="/"></a> &copy; Nannan's Blog 2014</section>
        <section class="poweredby">Published with <a target="_blank" href="http://hexo.io/">Hexo   </a> and Theme by <a target="_blank" href="https://github.com/yuche/hexo-theme-kael">Kael</a></section>
    </div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
    <a id="close-button" href="#">X</a>
    <div class="block">
        <div class="loading">
            <span class="ball1"></span>
            <span class="ball2"></span>
        </div>
    </div>
</div>
  
<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
    if (!window.jQuery) {
        var script = document.createElement('script');
        script.src = "/js/jquery.min.js";
        document.body.appendChild(script);
    }
</script>
<script type="text/javascript" src="/js/lib.js"></script>
<script type="text/javascript" src="/js/main.js"></script>




<script type="text/javascript">
    var disqus_shortname = 'disqus_uDZPCEcmPh';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body>
</html>
